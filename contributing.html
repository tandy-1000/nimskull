<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- CSS -->
<title>Contributing</title>
<link rel="stylesheet" type="text/css" href="nimdoc.out.css">

<script type="text/javascript" src="dochack.js"></script>

<script type="text/javascript">
function main() {
  var pragmaDots = document.getElementsByClassName("pragmadots");
  for (var i = 0; i < pragmaDots.length; i++) {
    pragmaDots[i].onclick = function(event) {
      // Hide tease
      event.target.parentNode.style.display = "none";
      // Show actual
      event.target.parentNode.nextElementSibling.style.display = "inline";
    }
  }

  function switchTheme(e) {
      if (e.target.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
      } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
      }
  }

  const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
  if (toggleSwitch !== null) {
    toggleSwitch.addEventListener('change', switchTheme, false);
  }

  var currentTheme = localStorage.getItem('theme');
  if (!currentTheme && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    currentTheme = 'dark';
  }
  if (currentTheme) {
    document.documentElement.setAttribute('data-theme', currentTheme);

    if (currentTheme === 'dark' && toggleSwitch !== null) {
      toggleSwitch.checked = true;
    }
  }
}

window.addEventListener('DOMContentLoaded', main);
</script>

</head>
<body>
<div class="document" id="documentId">
  <div class="container">
    <h1 class="title">Contributing</h1>
    <div class="row">
  <div class="three columns">
  <div class="theme-switch-wrapper">
    <label class="theme-switch" for="checkbox">
      <input type="checkbox" id="checkbox" />
      <div class="slider round"></div>
    </label>
    &nbsp;&nbsp;&nbsp; <em>Dark Mode</em>
  </div>
  <div id="global-links">
    <ul class="simple-boot">
      <li><a href="manual.html">Manual</a></li>
      <li><a href="style_guide.html">Style guide</a></li>
      <li><a href="contributing.html">Contribution guide</a></li>
      <li><a href="lib.html">Standard library</a></li>
      <li><a href="theindex.html">Index</a></li>
      <li><a href="compiler/theindex.html">Compiler docs</a></li>
    </ul>
  </div>
  <div id="searchInputDiv">
    Search: <input type="text" id="searchInput"
      onkeyup="search()" />
  </div>
    <div class="search-groupby">
    Group by:
    <select onchange="groupBy(this.value)">
      <option value="section">Section</option>
      <option value="type">Type</option>
    </select>
  </div>

  <ul class="simple simple-toc" id="toc-list">
<li><a class="reference" id="getting-context_toc" href="#getting-context">Getting Context</a></li>
<li><a class="reference" id="writing-or-improving-tests_toc" href="#writing-or-improving-tests">Writing or improving tests</a></li>
<ul class="simple"><li><a class="reference" id="writing-or-improving-tests-cleaning-up-existing-tests_toc" href="#writing-or-improving-tests-cleaning-up-existing-tests">Cleaning up existing tests</a></li>
<li><a class="reference" id="writing-or-improving-tests-improving-language-specification_toc" href="#writing-or-improving-tests-improving-language-specification">Improving Language specification</a></li>
<li><a class="reference" id="writing-or-improving-tests-stdlib_toc" href="#writing-or-improving-tests-stdlib">Stdlib</a></li>
<li><a class="reference" id="writing-or-improving-tests-compiler_toc" href="#writing-or-improving-tests-compiler">Compiler</a></li>
</ul><li><a class="reference" id="running-tests_toc" href="#running-tests">Running tests</a></li>
<li><a class="reference" id="comparing-tests_toc" href="#comparing-tests">Comparing tests</a></li>
<li><a class="reference" id="deprecation_toc" href="#deprecation">Deprecation</a></li>
<li><a class="reference" id="documentation_toc" href="#documentation">Documentation</a></li>
<li><a class="reference" id="pr-and-commit-message-guidelines_toc" href="#pr-and-commit-message-guidelines">Pr and commit message guidelines</a></li>
<ul class="simple"><li><a class="reference" id="pr-and-commit-message-guidelines-commit-message-guidelines_toc" href="#pr-and-commit-message-guidelines-commit-message-guidelines">Commit message guidelines</a></li>
<ul class="simple"><li><a class="reference" id="commit-message-guidelines-rules_toc" href="#commit-message-guidelines-rules">Rules</a></li>
<li><a class="reference" id="commit-message-guidelines-message-examples_toc" href="#commit-message-guidelines-message-examples">Message examples</a></li>
<li><a class="reference" id="commit-message-guidelines-additional-considerations_toc" href="#commit-message-guidelines-additional-considerations">Additional considerations</a></li>
</ul><li><a class="reference" id="pr-and-commit-message-guidelines-pull-requests-message_toc" href="#pr-and-commit-message-guidelines-pull-requests-message">Pull requests message</a></li>
</ul><li><a class="reference" id="the-cmdgit-stuff_toc" href="#the-cmdgit-stuff">The <tt class="docutils literal"><span class="pre"><span class="program">git</span></span></tt> stuff</a></li>
<ul class="simple"><li><a class="reference" id="the-cmdgit-stuff-pr-should-contain-a-single-commit_toc" href="#the-cmdgit-stuff-pr-should-contain-a-single-commit">PR should contain a single commit</a></li>
<li><a class="reference" id="the-cmdgit-stuff-continuous-integration-ci_toc" href="#the-cmdgit-stuff-continuous-integration-ci">Continuous Integration (CI)</a></li>
<li><a class="reference" id="the-cmdgit-stuff-debugging-ci-failures-flaky-tests-etc_toc" href="#the-cmdgit-stuff-debugging-ci-failures-flaky-tests-etc">Debugging CI failures, flaky tests, etc</a></li>
</ul><li><a class="reference" id="documentation-style_toc" href="#documentation-style">Documentation Style</a></li>
<ul class="simple"><li><a class="reference" id="documentation-style-general-guidelines_toc" href="#documentation-style-general-guidelines">General Guidelines</a></li>
<li><a class="reference" id="documentation-style-moduleminuslevel-documentation_toc" href="#documentation-style-moduleminuslevel-documentation">Module-level documentation</a></li>
<li><a class="reference" id="documentation-style-procs-templates-macros-converters-and-iterators_toc" href="#documentation-style-procs-templates-macros-converters-and-iterators">Procs, Templates, Macros, Converters, and Iterators</a></li>
<li><a class="reference" id="documentation-style-types_toc" href="#documentation-style-types">Types</a></li>
<li><a class="reference" id="documentation-style-var-let-and-const_toc" href="#documentation-style-var-let-and-const">Var, Let, and Const</a></li>
</ul><li><a class="reference" id="evolving-the-stdlib_toc" href="#evolving-the-stdlib">Evolving the stdlib</a></li>
<ul class="simple"><li><a class="reference" id="evolving-the-stdlib-what-the-compiler-itself-needs-must-be-part-of-the-stdlib_toc" href="#evolving-the-stdlib-what-the-compiler-itself-needs-must-be-part-of-the-stdlib">What the compiler itself needs must be part of the stdlib</a></li>
<li><a class="reference" id="evolving-the-stdlib-vocabulary-types-must-be-part-of-the-stdlib_toc" href="#evolving-the-stdlib-vocabulary-types-must-be-part-of-the-stdlib">Vocabulary types must be part of the stdlib</a></li>
<li><a class="reference" id="evolving-the-stdlib-existing-battleminustested-modules-stay_toc" href="#evolving-the-stdlib-existing-battleminustested-modules-stay">Existing, battle-tested modules stay</a></li>
<li><a class="reference" id="evolving-the-stdlib-syntactic-helpers-can-start-as-experimental-stdlib-modules_toc" href="#evolving-the-stdlib-syntactic-helpers-can-start-as-experimental-stdlib-modules">Syntactic helpers can start as experimental stdlib modules</a></li>
<li><a class="reference" id="evolving-the-stdlib-other-new-stdlib-modules-do-not-start-as-stdlib-modules_toc" href="#evolving-the-stdlib-other-new-stdlib-modules-do-not-start-as-stdlib-modules">Other new stdlib modules do not start as stdlib modules</a></li>
<li><a class="reference" id="evolving-the-stdlib-little-additions-are-acceptable_toc" href="#evolving-the-stdlib-little-additions-are-acceptable">Little additions are acceptable</a></li>
<li><a class="reference" id="evolving-the-stdlib-conventions_toc" href="#evolving-the-stdlib-conventions">Conventions</a></li>
</ul><li><a class="reference" id="breaking-changes_toc" href="#breaking-changes">Breaking Changes</a></li>
<ul class="simple"><li><a class="reference" id="breaking-changes-runminustime-breaking-changes_toc" href="#breaking-changes-runminustime-breaking-changes">Run-time breaking changes</a></li>
<li><a class="reference" id="breaking-changes-compileminustime-breaking-changes_toc" href="#breaking-changes-compileminustime-breaking-changes">Compile-time breaking changes</a></li>
<li><a class="reference" id="breaking-changes-compilerslashlanguage-spec-bugfixes_toc" href="#breaking-changes-compilerslashlanguage-spec-bugfixes">Compiler/language spec bugfixes</a></li>
<li><a class="reference" id="breaking-changes-nonminusbreaking-changes_toc" href="#breaking-changes-nonminusbreaking-changes">Non-breaking changes</a></li>
</ul>
</ul>

  </div>
  &nbsp;&nbsp;<a
href="https://github.com/nim-lang/Nim/tree/63b5341aa30532bda5663892e69a7bd78e9e490e/doc/contributing.rst#L1"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-lang/Nim/edit/devel/doc/contributing.rst#L1" class="link-seesrc" target="_blank" >Edit</a>

  <div class="nine columns" id="content">
  <div id="tocRoot"></div>
  
  <p class="module-desc"><p>If you're looking to make larger changes and even if not, please read this short blurb on <a class="reference external" href="https://github.com/nim-works/nimskull#direction">the direction</a> of the language.</p>
<p>Specifically, we value  sustainability. This means that the way we work together, our customs and practices, the design and development of the language and associated libraries, tools and so on, all work towards this goal.</p>

<h1><a class="toc-backref" id="getting-context" href="#getting-context">Getting Context</a></h1><p>Not everything is being worked on and somethings may in fact be up for removal outright. It's a big code base and not always easy to see where things are headed or whether your change will be accepted. What trade-offs to make and all sorts of questions that arise during software development.</p>
<p>For a very small change (typos, fixes, etc) please, open up a PR with tests and a fix, with help from the rest of this guide this will be quick and easy.</p>
<p>For more impactful or sweeping changes or you'd like to do things work on things more regularly, then please gain context through some of these suggested activities:</p>
<ul class="simple"><li>check the <a class="reference external" href="https://github.com/nim-works/nimskull#near-term-development">current near-term development plan</a></li>
<li>see current efforts by reading the last <a class="reference external" href="https://github.com/nim-works/nimskull/commits/devel">~10 commits messages</a></li>
<li>to understand the current broader ideas, <a class="reference external" href="https://github.com/nim-works/nimskull/discussions">see recent discussions</a></li>
<li>check out roadmap progression <a class="reference external" href="https://github.com/nim-works/nimskull/discussions/142?sort=new">thread</a> for a high-level overview</li>
<li>join our <a class="reference external" href="https://matrix.to/#/#nimworks:envs.net">matrix chat</a></li>
</ul>
<p>With that said, contributing happens via &quot;Pull requests&quot; (PR) on github. Every PR needs to be reviewed before it can be merged and the Continuous Integration should be green.</p>
<p>The PR has to be approved by at least one core developer, if a breaking change then mulitple core developers must weigh in.</p>

<h1><a class="toc-backref" id="writing-or-improving-tests" href="#writing-or-improving-tests">Writing or improving tests</a></h1><p>We recommend starting with tests, in fact one of our goals, and that is key to  sustainability is writing the language specification as tests. Getting comprehensive specification is one of the main goals of the  nimskull at the moment - contributions are more than welcome. You can learn more details about the spec structure <a class="reference external" href="spec.html#">here</a>.</p>
<p>Types of testing approaches, in order of preference. Where marked as deprecated these are to be converted where possible and not used going forward:</p>
<ol class="simple"><li>separate test files, e.g.: <tt class="docutils literal"><span class="pre">tests/stdlib/tos.nim</span></tt>. In  NimSkull repo, <tt class="docutils literal"><span class="pre"><span class="program">testament</span></span></tt> (see below) runs all <tt class="docutils literal"><span class="pre">$nim/tests/*/t*.nim</span></tt> test files<ul class="simple"><li>Usage of <tt class="docutils literal"><span class="pre">echo</span></tt> in tests is discouraged and should be replaced with <tt class="docutils literal"><span class="pre">doAssert</span></tt> when possible. Assertion-based tests are easier to read (condition for test pass is written in the test itself) and move around when needed (for running single piece of code for debugging, or moving whole test into another file)</li>
<li>Don't forget to add <tt class="docutils literal"><span class="pre"><span class="Identifier">description</span><span class="Punctuation">:</span></span></tt> field to the testament specification</li>
<li>Also comment on the test's parts. Well-written test with careful explanation of what is going on, or why particular element is tested in this manner can serve as a powerful teaching tool.</li>
</ul>
</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">runnableExamples</span></span></tt> documentation comment tests, ran by <tt class="docutils literal"><span class="pre"><span class="program">nim</span> <span class="option">doc</span> <span class="Identifier">mymod.nim</span></span></tt> These end up in documentation and ensure documentation stays in sync with code.</li>
</ol>
<div class="admonition admonition-info"><span class="admonition-info-text"><b>Note:</b></span>
Not all the tests follow the convention here, feel free to change the ones that don't. Always leave the code cleaner than you found it. Usage of deprecated tests styles is almost guaranteed to lead to PR rejection.</div>
<div class="admonition admonition-info"><span class="admonition-info-text"><b>Note:</b></span>
Progress of the test suite improvements is tracked in the github <a class="reference external" href="https://github.com/nim-works/nimskull/projects/2">project</a>.</div>

<h2><a class="toc-backref" id="writing-or-improving-tests-cleaning-up-existing-tests" href="#writing-or-improving-tests-cleaning-up-existing-tests">Cleaning up existing tests</a></h2><p>Original collection of tests in the test suite contained a lot of files that did not conform to the requirements listed above, and should eventually be fixed. See <a class="reference external" href="https://github.com/nim-works/nimskull/issues/41">Clean up and reorder tests #41</a> issue on github for more context and relevant discussion.</p>

<h2><a class="toc-backref" id="writing-or-improving-tests-improving-language-specification" href="#writing-or-improving-tests-improving-language-specification">Improving Language specification</a></h2><p>In order to have the confidence in the compiler implementation and it's behaviour we must provide a comprehensive suite of checks for the compiler behavior. This is a complex undertaking as a whole, but it can be easily split in a smaller contributions.</p>

<h2><a class="toc-backref" id="writing-or-improving-tests-stdlib" href="#writing-or-improving-tests-stdlib">Stdlib</a></h2><p>Each stdlib module (anything under <tt class="docutils literal"><span class="pre">lib/</span></tt>, e.g. <tt class="docutils literal"><span class="pre">lib/pure/os.nim</span></tt>) should have a corresponding separate tests folder and files, e.g. <tt class="docutils literal"><span class="pre">tests/stdOs/tos.nim</span></tt>.</p>
<p>Each test should be in a separate <tt class="docutils literal"><span class="pre"><span class="Keyword">block</span><span class="Punctuation">:</span></span></tt> statement, such that each has its own scope. Use boolean conditions and <tt class="docutils literal"><span class="pre"><span class="Identifier">doAssert</span></span></tt> for the testing by itself, don't rely on echo statements or similar; in particular, avoid things like <tt class="docutils literal"><span class="pre"><span class="Identifier">echo</span> <span class="StringLit">&quot;done&quot;</span></span></tt>.</p>
<p>A few notes on things to watch out for and not repeat. An old convention was to add a <tt class="docutils literal"><span class="pre"><span class="Keyword">when</span> <span class="Identifier">isMainModule</span><span class="Punctuation">:</span></span></tt> block in the source file, which only gets executed when the tester is building the file. Don't use <tt class="docutils literal"><span class="pre"><span class="Identifier">unittest</span><span class="Operator">.</span><span class="Identifier">suite</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">unittest</span><span class="Operator">.</span><span class="Identifier">test</span></span></tt>.</p>
<p>Please replace this if you're making changes associated to the module.</p>
<p>Sample test:</p>
<pre class="listing"><span class="Keyword">block</span> <span class="Identifier">foo_multiplies_by_10</span><span class="Punctuation">:</span>
  <span class="Identifier">doAssert</span> <span class="Identifier">foo</span><span class="Punctuation">(</span><span class="DecNumber">1</span><span class="Punctuation">)</span> <span class="Operator">==</span> <span class="DecNumber">10</span>

<span class="Keyword">block</span> <span class="Identifier">int_constant_expression_evaluation</span><span class="Punctuation">:</span>
  <span class="Comment">## encountered a regressions with integer constant expression evaluation</span>
  <span class="Comment">## see bug #1234</span>
  <span class="Keyword">static</span><span class="Punctuation">:</span> <span class="Identifier">doAssert</span> <span class="DecNumber">1</span><span class="Operator">+</span><span class="DecNumber">1</span> <span class="Operator">==</span> <span class="DecNumber">2</span><span class="Punctuation">,</span> <span class="StringLit">&quot;int constant expression evaluation regression&quot;</span>

<span class="Keyword">block</span> <span class="Identifier">structural_comparison_of_nested_seqs</span><span class="Punctuation">:</span>
  <span class="Keyword">var</span> <span class="Identifier">seq2D</span> <span class="Operator">=</span> <span class="Identifier">newSeqWith</span><span class="Punctuation">(</span><span class="DecNumber">4</span><span class="Punctuation">,</span> <span class="Identifier">newSeq</span><span class="Punctuation">[</span><span class="Identifier">bool</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="DecNumber">2</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
  <span class="Identifier">seq2D</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">]</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">true</span>
  <span class="Identifier">seq2D</span><span class="Punctuation">[</span><span class="DecNumber">1</span><span class="Punctuation">]</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">true</span>
  <span class="Identifier">seq2D</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">]</span><span class="Punctuation">[</span><span class="DecNumber">1</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">true</span>
  <span class="Identifier">doAssert</span> <span class="Identifier">seq2D</span> <span class="Operator">==</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="Operator">@</span><span class="Punctuation">[</span><span class="Identifier">true</span><span class="Punctuation">,</span> <span class="Identifier">true</span><span class="Punctuation">]</span><span class="Punctuation">,</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="Identifier">true</span><span class="Punctuation">,</span> <span class="Identifier">false</span><span class="Punctuation">]</span><span class="Punctuation">,</span>
                      <span class="Operator">@</span><span class="Punctuation">[</span><span class="Identifier">false</span><span class="Punctuation">,</span> <span class="Identifier">false</span><span class="Punctuation">]</span><span class="Punctuation">,</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="Identifier">false</span><span class="Punctuation">,</span> <span class="Identifier">false</span><span class="Punctuation">]</span><span class="Punctuation">]</span>
  <span class="Comment"># doAssert with `not` can now be done as follows:</span>
  <span class="Identifier">doAssert</span> <span class="Keyword">not</span> <span class="Punctuation">(</span><span class="DecNumber">1</span> <span class="Operator">==</span> <span class="DecNumber">2</span><span class="Punctuation">)</span></pre><p>Always refer to a GitHub issue using the following exact syntax: <tt class="docutils literal"><span class="pre">bug #1234</span></tt> as shown above, so that it's consistent and easier to search or for tooling. Some browser extensions (e.g. <a class="reference external" href="https://github.com/sindresorhus/refined-github">https://github.com/sindresorhus/refined-github</a>) will even turn those in clickable links when it works.</p>
<p>Rationale for using a separate test file instead of <tt class="docutils literal"><span class="pre"><span class="Keyword">when</span> <span class="Identifier">isMainModule</span><span class="Punctuation">:</span></span></tt> block:</p>
<ul class="simple"><li>allows custom compiler flags or testing options (see details below)</li>
<li>faster CI since they can be joined in <tt class="docutils literal"><span class="pre">megatest</span></tt> (combined into a single test)</li>
<li>avoids making the parser do un-necessary work when a source file is merely imported</li>
<li>avoids mixing source and test code when reporting line of code statistics or code coverage</li>
</ul>

<h2><a class="toc-backref" id="writing-or-improving-tests-compiler" href="#writing-or-improving-tests-compiler">Compiler</a></h2><p>The tests for the compiler use a testing tool called <tt class="docutils literal"><span class="pre"><span class="program">testament</span></span></tt>. They are all located in <tt class="docutils literal"><span class="pre">tests/</span></tt> (e.g.: <tt class="docutils literal"><span class="pre">tests/destructor/tdestructor3.nim</span></tt>). Each test has its own file. All test files are prefixed with <tt class="docutils literal"><span class="pre"><span class="Identifier">t</span></span></tt>. If you want to create a file for import into another test only, use the prefix <tt class="docutils literal"><span class="pre"><span class="Identifier">m</span></span></tt>.</p>
<p>At the beginning of every test is the expected behavior of the test. Possible keys are:</p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Identifier">description</span></span></tt>: Description for the overall goal of tests within this file</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">cmd</span></span></tt>: A compilation command template e.g. <tt class="docutils literal"><span class="pre"><span class="program">nim</span> <span class="option">$target</span> <span class="option">--threads:on</span> <span class="option">$options</span> <span class="option">$file</span></span></tt></li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">output</span></span></tt>: The expected output (stdout + stderr), most likely via <tt class="docutils literal"><span class="pre"><span class="Identifier">echo</span></span></tt></li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">exitcode</span></span></tt>: Exit code of the test (via <tt class="docutils literal"><span class="pre"><span class="Identifier">exit</span><span class="Punctuation">(</span><span class="Identifier">number</span><span class="Punctuation">)</span></span></tt>)</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">errormsg</span></span></tt>: The expected compiler error message</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">file</span></span></tt>: The file the errormsg was produced at</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">line</span></span></tt>: The line the errormsg was produced at</li>
</ul>
<p>For a full spec, see here: <tt class="docutils literal"><span class="pre">testament/specs.nim</span></tt></p>
<p>An example of a test:</p>
<pre class="listing"><span class="Keyword">discard</span> <span class="LongStringLit">&quot;&quot;&quot;
  description: &quot;parameter type mismatch results in an error&quot;
  errormsg: &quot;type mismatch: got (PTest)&quot;
&quot;&quot;&quot;</span>

<span class="Keyword">type</span>
  <span class="Identifier">PTest</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span>

<span class="Keyword">proc</span> <span class="Identifier">test</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">PTest</span><span class="Punctuation">,</span> <span class="Identifier">y</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Keyword">nil</span>

<span class="Keyword">var</span> <span class="Identifier">buf</span><span class="Punctuation">:</span> <span class="Identifier">PTest</span>
<span class="Identifier">buf</span><span class="Operator">.</span><span class="Identifier">test</span><span class="Punctuation">(</span><span class="Punctuation">)</span></pre>
<h1><a class="toc-backref" id="running-tests" href="#running-tests">Running tests</a></h1><p>You can run the tests with</p>
<pre class="listing"><span class="program">./koch.py</span> <span class="option">tests</span></pre><p>which will run a good subset of tests. Some tests may fail. If you only want to see the output of failing tests, go for</p>
<p><pre class="listing"><span class="program">./koch.py</span> <span class="option">tests</span> <span class="option">--failing</span> <span class="option">all</span>
</pre></p>
<p>You can also run only a single category of tests. A category is a subdirectory in the <tt class="docutils literal"><span class="pre">tests/</span></tt> directory. There are a couple of special categories; for a list of these, see <tt class="docutils literal"><span class="pre">testament/categories.nim</span></tt>, at the bottom.</p>
<pre class="listing"><span class="program">./koch.py</span> <span class="option">tests</span> <span class="option">c</span> <span class="option">lib</span> <span class="Comment"># compiles / runs stdlib modules, including `isMainModule` tests</span>
<span class="program">./koch.py</span> <span class="option">tests</span> <span class="option">c</span> <span class="option">megatest</span> <span class="Comment"># runs a set of tests that can be combined into 1</span></pre><p>To run a single test:</p>
<pre class="listing"><span class="program">./koch.py</span> <span class="option">test</span> <span class="option">run</span> <span class="Identifier">&lt;category&gt;/&lt;name&gt;</span>    <span class="Comment"># e.g.: tuples/ttuples_issues</span>
<span class="program">./koch.py</span> <span class="option">test</span> <span class="option">run</span> <span class="Identifier">tests/stdlib/tos.nim</span> <span class="Comment"># can also provide relative path</span></pre><p>For reproducible tests (to reproduce an environment more similar to the one run by Continuous Integration on github actions/azure pipelines), you may want to disable your local configuration (e.g. in <tt class="docutils literal"><span class="pre">~/.config/nim/nim.cfg</span></tt>) which may affect some tests; this can also be achieved by using <tt class="docutils literal"><span class="pre"><span class="program">export</span> <span class="option">XDG_CONFIG_HOME=pathtoAlternateConfig</span></span></tt> before running <tt class="docutils literal"><span class="pre"><span class="program">./koch.py</span></span></tt> commands.</p>

<h1><a class="toc-backref" id="comparing-tests" href="#comparing-tests">Comparing tests</a></h1><p>Test failures can be grepped using <tt class="docutils literal"><span class="pre">Failure:</span></tt>.</p>
<p>The tester can compare two test runs. First, you need to create a reference test. You'll also need to the commit id, because that's what the tester needs to know in order to compare the two.</p>
<pre class="listing"><span class="program">git</span> <span class="option">checkout</span> <span class="option">devel</span>
<span class="Identifier">DEVEL_COMMIT=$</span><span class="Operator">(</span><span class="program">git</span> <span class="option">rev-parse</span> <span class="option">HEAD</span><span class="Operator">)</span>
<span class="program">./koch.py</span> <span class="option">tests</span></pre><p>Then switch over to your changes and run the tester again.</p>
<pre class="listing"><span class="program">git</span> <span class="option">checkout</span> <span class="option">your-changes</span>
<span class="program">./koch.py</span> <span class="option">tests</span></pre><p>Then you can ask the tester to create a <tt class="docutils literal"><span class="pre">testresults.html</span></tt> which will tell you if any new tests passed/failed.</p>
<pre class="listing"><span class="program">./koch.py</span> <span class="option">tests</span> <span class="option">--print</span> <span class="option">html</span> <span class="option">$DEVEL_COMMIT</span></pre>
<h1><a class="toc-backref" id="deprecation" href="#deprecation">Deprecation</a></h1><p>Backward compatibility is important, so instead of a rename you need to deprecate the old name and introduce a new name:</p>
<pre class="listing"><span class="Comment"># for routines (proc/template/macro/iterator) and types:</span>
<span class="Keyword">proc</span> <span class="Identifier">oldProc</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">,</span> <span class="Identifier">b</span><span class="Punctuation">:</span> <span class="Identifier">float</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">bool</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">deprecated</span><span class="Punctuation">:</span>
    <span class="StringLit">&quot;deprecated since v1.2.3; use `newImpl: string -&gt; int` instead&quot;</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span> <span class="Keyword">discard</span>

<span class="Comment"># for (const/var/let/fields) the msg is not yet supported:</span>
<span class="Keyword">const</span> <span class="Identifier">Foo</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">deprecated</span><span class="Operator">.</span><span class="Punctuation">}</span>  <span class="Operator">=</span> <span class="DecNumber">1</span>

<span class="Comment"># for enum types, you can deprecate the type or some elements</span>
<span class="Comment"># (likewise with object types and their fields):</span>
<span class="Keyword">type</span> <span class="Identifier">Bar</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">deprecated</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span> <span class="Keyword">enum</span> <span class="Identifier">bar0</span><span class="Punctuation">,</span> <span class="Identifier">bar1</span>
<span class="Keyword">type</span> <span class="Identifier">Barz</span>  <span class="Operator">=</span> <span class="Keyword">enum</span> <span class="Identifier">baz0</span><span class="Punctuation">,</span> <span class="Identifier">baz1</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">deprecated</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">,</span> <span class="Identifier">baz2</span></pre><p>See also <a class="reference external" href="manual.html#pragmas-deprecated-pragma">Deprecated</a> pragma in the manual.</p>

<h1><a class="toc-backref" id="documentation" href="#documentation">Documentation</a></h1><p>When contributing new procs, be sure to add documentation, especially if the proc is public. Even private procs benefit from documentation and can be viewed using <tt class="docutils literal"><span class="pre"><span class="program">nim</span> <span class="option">doc</span> <span class="option">--docInternal</span> <span class="Identifier">foo.nim</span></span></tt>. Documentation begins on the line following the <tt class="docutils literal"><span class="pre"><span class="Keyword">proc</span></span></tt> definition, and is prefixed by <tt class="docutils literal"><span class="pre"><span class="Comment">##</span></span></tt> on each line.</p>
<p>Runnable code examples are also encouraged, to show typical behavior with a few test cases (typically 1 to 3 <tt class="docutils literal"><span class="pre"><span class="Identifier">assert</span></span></tt> statements, depending on complexity). These <tt class="docutils literal"><span class="pre"><span class="Identifier">runnableExamples</span></span></tt> are automatically run by <tt class="docutils literal"><span class="pre"><span class="program">nim</span> <span class="option">doc</span> <span class="Identifier">mymodule.nim</span></span></tt> as well as <tt class="docutils literal"><span class="pre"><span class="program">testament</span></span></tt> and guarantee they stay in sync.</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">addBar</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span>
  <span class="Comment">## Adds &quot;Bar&quot; to `a`.</span>
  <span class="Identifier">runnableExamples</span><span class="Punctuation">:</span>
    <span class="Identifier">assert</span> <span class="StringLit">&quot;baz&quot;</span><span class="Operator">.</span><span class="Identifier">addBar</span> <span class="Operator">==</span> <span class="StringLit">&quot;bazBar&quot;</span>
  <span class="Identifier">result</span> <span class="Operator">=</span> <span class="Identifier">a</span> <span class="Operator">&amp;</span> <span class="StringLit">&quot;Bar&quot;</span></pre><p>See <a class="reference external" href="os.html#parentDir,string">parentDir</a> example.</p>
<p>The RestructuredText  NimSkull uses has a special syntax for including code snippets embedded in documentation; these are not run by <tt class="docutils literal"><span class="pre"><span class="program">nim</span> <span class="option">doc</span></span></tt> and therefore are not guaranteed to stay in sync, so <tt class="docutils literal"><span class="pre"><span class="Identifier">runnableExamples</span></span></tt> is almost always preferred:</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">someProc</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span>
  <span class="Comment">## Returns &quot;something&quot;</span>
  <span class="Comment">##</span>
  <span class="Comment">## .. code-block::</span>
  <span class="Comment">##  echo someProc() # &quot;something&quot;</span>
  <span class="Identifier">result</span> <span class="Operator">=</span> <span class="StringLit">&quot;something&quot;</span> <span class="Comment"># single-hash comments do not produce documentation</span></pre><p>The <tt class="docutils literal"><span class="pre">.. code-block:: nim</span></tt> followed by a newline and an indentation instructs the <tt class="docutils literal"><span class="pre"><span class="program">nim</span> <span class="option">doc</span></span></tt> command to produce syntax-highlighted example code with the documentation (<tt class="docutils literal"><span class="pre">.. code-block::</span></tt> is sufficient from inside a nim module).</p>
<p>When forward declaration is used, the documentation should be included with the first appearance of the proc.</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">hello</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span>
  <span class="Comment">## Put documentation here</span>
<span class="Keyword">proc</span> <span class="Identifier">nothing</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Keyword">discard</span>
<span class="Keyword">proc</span> <span class="Identifier">hello</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span>
  <span class="Comment">## ignore this</span>
  <span class="Identifier">echo</span> <span class="StringLit">&quot;hello&quot;</span></pre><p>The preferred documentation style is to begin with a capital letter and use the third-person singular. That is, between:</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">hello</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span>
  <span class="Comment">## Returns &quot;hello&quot;</span>
  <span class="Identifier">result</span> <span class="Operator">=</span> <span class="StringLit">&quot;hello&quot;</span></pre><p>or</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">hello</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span>
  <span class="Comment">## say hello</span>
  <span class="Identifier">result</span> <span class="Operator">=</span> <span class="StringLit">&quot;hello&quot;</span></pre><p>the first is preferred.</p>
<p>When you specify an <em>RST role</em> (highlighting/interpretation marker) do it in the postfix form for uniformity, that is after `text in backticks`. For example an <tt class="docutils literal"><span class="pre">:idx:</span></tt> role for referencing a topic (&quot;SQLite&quot; in the example below) from <a class="reference external" href="https://nim-works.github.io/nimskull/theindex.html">NimSkull Index</a> can be used in doc comment this way:</p>
<pre class="listing"><span class="Comment">## A higher level `SQLite`:idx: database wrapper.</span></pre><p>Inline monospaced text can be input using `single backticks` or ``double backticks``. The former are syntactically highlighted, the latter are not. To avoid accidental highlighting follow this rule in <tt class="docutils literal"><span class="pre">*.nim</span></tt> files:</p>
<ul class="simple"><li><p>use single backticks for fragments of code in  NimSkull and other programming languages, including identifiers, in <tt class="docutils literal"><span class="pre">*.nim</span></tt> files.</p>
<p>For languages other than  NimSkull add a role after final backtick, e.g. for C++ inline highlighting:<pre>`#include &lt;stdio.h&gt;`:cpp:</pre>
</p>
<p>For a currently unsupported language add the <tt class="docutils literal"><span class="pre"><span class="Punctuation">:</span><span class="Identifier">code</span><span class="Punctuation">:</span></span></tt> role, like for SQL in this example:<pre>`SELECT * FROM &lt;table_name&gt;;`:code:</pre>
</p>
<p>Highlight shell commands by <tt class="docutils literal"><span class="pre">:cmd:</span></tt> role; for command line options use <tt class="docutils literal"><span class="pre">:option:</span></tt> role, e.g.: `--docInternal`:option:.</p>
</li>
<li>prefer double backticks otherwise:<ul class="simple"><li>for file names: ``os.nim``</li>
<li>for fragments of strings <strong>not</strong> enclosed by <tt class="docutils literal"><span class="pre"><span class="StringLit">&quot;</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="StringLit">&quot;</span></span></tt> and not related to code, e.g. text of compiler messages</li>
<li>also when code ends with a standalone <tt class="docutils literal"><span class="pre">\</span></tt> (otherwise a combination of <tt class="docutils literal"><span class="pre">\</span></tt> and a final ` would get escaped)</li>
</ul>
</li>
</ul>
<div class="admonition admonition-info"><span class="admonition-info-text"><b>Note:</b></span>
<p><tt class="docutils literal"><span class="pre">*.rst</span></tt> files have <tt class="docutils literal"><span class="pre">:literal:</span></tt> as their default role. So for them the rule above is only applicable if the <tt class="docutils literal"><span class="pre">:nim:</span></tt> role is set up manually as the default <sup><strong><a class="reference internal" href="#footnotesym-1">[*]</a></strong></sup>:<pre>.. role:: nim(code)
   :language: nim
.. default-role:: nim</pre>
</p>
<p>The first 2 lines are for other RST implementations, including Github one.</p>
<hr class="footnote"><div class="footnote-group">
<div id="footnotesym-1"><div class="footnote-label"><sup><strong><a href="#footnotesym-1">[*]</a></strong></sup></div> &ensp; this is fulfilled when <tt class="docutils literal"><span class="pre">doc/rstcommon.rst</span></tt> is included.
</div>
</div>
</div>

<h1><a class="toc-backref" id="pr-and-commit-message-guidelines" href="#pr-and-commit-message-guidelines">Pr and commit message guidelines</a></h1>
<h2><a class="toc-backref" id="pr-and-commit-message-guidelines-commit-message-guidelines" href="#pr-and-commit-message-guidelines-commit-message-guidelines">Commit message guidelines</a></h2><p>One of the key goals of the  nimskull project is sustainability. Writing good commit messages is important, since future contributors need to have a way to reason about decitions made in the past.</p>
<p>It should be clear as to <em>&quot;what&quot;</em> change was made. Additional details like high-level oviewview of <em>&quot;how&quot;</em> and <em>&quot;why&quot;</em> are also welcome, but should go into commit body. Of course <em>&quot;what&quot;</em> can be contiued in the body as well.</p>
<pre class="listing">where: what? 50 chars or less

*why*? format to 72 chars width

Also consider writing about &quot;how?&quot; and/or more elaborate explanation of
&quot;what?&quot;</pre><ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="StringLit">&quot;where&quot;</span></span></tt> is optional, but recommended. It can be a specific file, or a subsystem (like <tt class="docutils literal"><span class="pre"><span class="Identifier">sem</span></span></tt> (semantic analysis in compiler), <tt class="docutils literal"><span class="pre"><span class="Identifier">lexer</span></span></tt> (compiler lexer), <tt class="docutils literal"><span class="pre"><span class="Identifier">stdlib</span></span></tt> (standard library), <tt class="docutils literal"><span class="pre"><span class="Identifier">tests</span></span></tt>, <tt class="docutils literal"><span class="pre"><span class="Identifier">spec</span></span></tt> (for language specification improvements) and so on)</li>
<li><tt class="docutils literal"><span class="pre"><span class="StringLit">&quot;what&quot;</span></span></tt> implementation details. Unless the commit is trivial (e.g. test added, dead code removed), it is better to document what exactly changed - you already know it, and it might save a <em>huge</em> amount of time to the next contributor.</li>
<li><tt class="docutils literal"><span class="pre"><span class="StringLit">&quot;why&quot;</span></span></tt> each change has a reason, however trivial it might be. Those reasons <strong>must</strong> be documented in a way that would allow future contributors to understand problems that you were trying to solve.</li>
</ul>

<h3><a class="toc-backref" id="commit-message-guidelines-rules" href="#commit-message-guidelines-rules">Rules</a></h3><p>Commit message should contain enough information in order for end user to understand what is going on by looking at the git log.</p>
<p>Example of bad commit message:<pre>Fixes #123; refs #124</pre>
</p>
<p>indicates that issue <tt class="docutils literal"><span class="pre">#123</span></tt> is completely fixed (GitHub may automatically close it when the PR is committed), wheres issue <tt class="docutils literal"><span class="pre">#124</span></tt> is referenced (e.g.: partially fixed) and won't close the issue when committed. This tells reader <strong>nothing</strong> about what the commit did, requires going into two separate github pages and reading through multiple comments in order to figure out what was <em>wrong</em> - not what <em>changed</em> in the commit.</p>
<p>Instead, commit title should contain a human-readable text (we are optimizing for humans after all)</p>
<ul class="simple"><li>Keep the title length to 50 characters, and commit message body to 72 characters.</li>
<li>If you want to use automatic &quot;fixes&quot; feature of the github, please supply full URL in the body instead, it makes it much easier to copy-paste and see (with pure hash you first need to understand whether change was in <tt class="docutils literal"><span class="pre">issues/</span></tt> or <tt class="docutils literal"><span class="pre">pull/</span></tt>, then open random PR/issue and replace hash URL).</li>
<li>Consider using &quot;Fixes&quot; for commits that fix bugs, and &quot;Closes&quot; for commits that implement features.</li>
<li>Most of the points on this list were derived from <a class="reference external" href="https://api.coala.io/en/latest/Developers/Writing_Good_Commits.html">How To Write a Good Commit Message</a> - we suggest reading it as well.</li>
</ul>
<p>Crafting good commit title might be hard at first. Some simple rules to look out for:</p>
<ul class="simple"><li>Avoid using phrases like <tt class="docutils literal"><span class="pre">&quot;minor fixes for XXX&quot;</span></tt>, <tt class="docutils literal"><span class="pre">&quot;various improvements&quot;</span></tt>, <tt class="docutils literal"><span class="pre">&quot;tiny patch&quot;</span></tt> - they don't add any substantial information and only clutter the title.</li>
<li>No bare github hashes in the title. Things like <tt class="docutils literal"><span class="pre">fix #19193 (#19195) [backport:1.2]</span></tt> are absolutely illegible.</li>
</ul>
<p>When writing commit message consider who are you writing this message for:</p>
<ul class="simple"><li>you or someone else in the far future found a bug and stumbled upon this in a git bisect</li>
<li>you or someone else is going through recent commits trying to write a changelog</li>
<li>you or someone else is trying to find a bug that can't be replicated reliably so they're reading commits seeing which might be related</li>
<li>someone new to the code base is trying to learn bits and pieces about what's being worked on and what types of things are changing</li>
<li>you or someone else is sorting out documentation or test gaps, or seeing if old issues can be closed with recent changes</li>
</ul>

<h3><a class="toc-backref" id="commit-message-guidelines-message-examples" href="#commit-message-guidelines-message-examples">Message examples</a></h3><p>This section is build in a do-don't manner.</p>
<ul class="simple"><li>Implementation details of a particular commit can go into the body, title should only contain <em>what?</em><ul class="simple"><li><tt class="docutils literal"><span class="pre">fixes #9456 by only calling c_fclose if non nil</span></tt> -&gt; <tt class="docutils literal"><span class="pre">Fix crash when closing an unopened file on debian</span></tt><ul class="simple"><li>Implementation details of the commit can be put in the commit body</li>
</ul>
</li>
<li><tt class="docutils literal"><span class="pre">Deprecate 'c', 'C' prefix for octal literals, fixes #8082 (#8178)</span></tt><ul class="simple"><li>Good, but commit hash should preferrably be replaced with a url.</li>
</ul>
</li>
<li><tt class="docutils literal"><span class="pre">fixes #12015 by also checking kind of typeNode</span></tt> -&gt; <tt class="docutils literal"><span class="pre">Fix unmarshal of aliased tuple field using json.to</span></tt><ul class="simple"><li>Again, implementation details go into commit body</li>
</ul>
</li>
</ul>
</li>
<li>No bare commit hashes:<ul class="simple"><li><tt class="docutils literal"><span class="pre">fixes #19051 [backport:1.6] (#19133)</span></tt> -&gt; <tt class="docutils literal"><span class="pre">Fix gcc codegen of `type G[T] = int`</span></tt> or <tt class="docutils literal"><span class="pre">Fix gcc codegen of generic int alias</span></tt>. Pr <strong>body</strong> should be<pre class="listing">Fixes https://github.com/nim-lang/Nim/issues/19051</pre></li>
<li><tt class="docutils literal"><span class="pre">update manual (#19130) [backport]</span></tt> -&gt; <tt class="docutils literal"><span class="pre">Add InstantiationInfo and EAssertionFailed to manual</span></tt> (new title message is 52 characters long, but in this case it is acceptable to go two characters over limit)</li>
</ul>
</li>
</ul>

<h3><a class="toc-backref" id="commit-message-guidelines-additional-considerations" href="#commit-message-guidelines-additional-considerations">Additional considerations</a></h3><ol class="simple"><li>If you introduce changes which affect backward compatibility, make breaking changes, or have PR which is tagged as <tt class="docutils literal"><span class="pre">[feature]</span></tt>, the changes should be mentioned in <a class="reference external" href="https://github.com/nim-works/nimskull/blob/devel/changelog.md">the changelog</a>.</li>
<li><p>All changes introduced by the commit (diff lines) must be related to the subject of the commit.</p>
<p>If you change something unrelated to the subject parts of the file, because your editor reformatted automatically the code or whatever different reason, this should be excluded from the commit.</p>
<p><em>Tip:</em> Never commit everything as is using <tt class="docutils literal"><span class="pre"><span class="program">git</span> <span class="option">commit</span> <span class="option">-a</span></span></tt>, but review carefully your changes with <tt class="docutils literal"><span class="pre"><span class="program">git</span> <span class="option">add</span> <span class="option">-p</span></span></tt>.</p>
</li>
<li><p>Changes should not introduce any trailing whitespace.</p>
<p>Always check your changes for whitespace errors using <tt class="docutils literal"><span class="pre"><span class="program">git</span> <span class="option">diff</span> <span class="option">--check</span></span></tt> or add the following <tt class="docutils literal"><span class="pre">pre-commit</span></tt> hook:</p>
<pre class="listing"><span class="Comment">#!/bin/sh</span>
<span class="program">git</span> <span class="option">diff</span> <span class="option">--check</span> <span class="option">--cached</span> <span class="Operator">||</span> <span class="program">exit</span> <span class="option">$?</span></pre></li>
<li><p>Commits should be always be rebased against devel (so a fast forward merge can happen)</p>
<p>e.g.: use <tt class="docutils literal"><span class="pre"><span class="program">git</span> <span class="option">pull</span> <span class="option">--rebase</span> <span class="option">origin</span> <span class="option">devel</span></span></tt>. This is to avoid messing up git history. Exceptions should be very rare: when rebase gives too many conflicts, simply squash all commits using the script shown in <a class="reference external" href="https://github.com/nim-lang/Nim/pull/9356">https://github.com/nim-lang/Nim/pull/9356</a></p>
</li>
<li>Do not mix pure formatting changes (e.g. whitespace changes, nimpretty) or automated changes (e.g. nimfix) with other code changes: these should be in separate commits (and the merge on GitHub should not squash these into 1).</li>
</ol>

<h2><a class="toc-backref" id="pr-and-commit-message-guidelines-pull-requests-message" href="#pr-and-commit-message-guidelines-pull-requests-message">Pull requests message</a></h2><p>Pull request description and title generally follow the same guidelines as commit messages.</p>

<h1><a class="toc-backref" id="the-cmdgit-stuff" href="#the-cmdgit-stuff">The <tt class="docutils literal"><span class="pre"><span class="program">git</span></span></tt> stuff</a></h1>
<h2><a class="toc-backref" id="the-cmdgit-stuff-pr-should-contain-a-single-commit" href="#the-cmdgit-stuff-pr-should-contain-a-single-commit">PR should contain a single commit</a></h2><p>Pull request should contain a single <strong>passing</strong> commit. This is necessary to ensure clean git history that is not cluttered by a partially working, failing and outright failing to compile states.</p>
<p>To achieve this you can do either of the following:</p>
<ul class="simple"><li>If the change fits into a single commit you don't need to do anything</li>
<li>If you need to made some additional modifications (review requested) you can amend the commit and force-push it (<tt class="docutils literal"><span class="pre"><span class="program">git</span> <span class="option">commit</span> <span class="option">--amend</span> <span class="option">--no-edit</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="program">git</span> <span class="option">push</span> <span class="option">--force</span> <span class="option">&lt;remote&gt;</span> <span class="option">&lt;your</span> <span class="option">branch&gt;</span></span></tt>)</li>
<li>Create multiple commits and then squash them when your pull request is approved.<ol class="simple"><li>Create multiple commits</li>
<li>Create new branch based on <tt class="docutils literal"><span class="pre"><span class="Identifier">devel</span></span></tt> (<tt class="docutils literal"><span class="pre"><span class="program">git</span> <span class="option">checkout</span> <span class="option">devel</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="program">git</span> <span class="option">checkout</span> <span class="option">&lt;branch&gt;-squashed</span></span></tt>)</li>
<li>Squash merge your original branch into a new one - <tt class="docutils literal"><span class="pre"><span class="program">git</span> <span class="option">merge</span> <span class="option">--squash</span> <span class="option">&lt;branch&gt;</span></span></tt></li>
<li>Commit your squashed branch using <tt class="docutils literal"><span class="pre"><span class="program">git</span> <span class="option">commit</span></span></tt><div class="admonition admonition-info"><span class="admonition-info-text"><b>Note:</b></span>
By default you will get pre-filled commit message which contains pretty verbose &quot;sqash of the following&quot; message - those are not going to be accepted by the PR reviewers, and need to be edited into human-readable error message according to the commit message guidelines.</div>
<div class="admonition admonition-info"><span class="admonition-info-text"><b>Tip:</b></span>
You can write a commit message as a PR description and then copy-paste it when you are done with the implementation.</div>
</li>
<li>Force-push your squashed branch using <tt class="docutils literal"><span class="pre"><span class="program">git</span> <span class="option">push</span> <span class="option">--force</span> <span class="option">&lt;remote&gt;</span> <span class="option">HEAD:&lt;branch&gt;</span></span></tt></li>
</ol>
</li>
</ul>

<h2><a class="toc-backref" id="the-cmdgit-stuff-continuous-integration-ci" href="#the-cmdgit-stuff-continuous-integration-ci">Continuous Integration (CI)</a></h2><ol class="simple"><li>Continuous Integration is by default run on every push in a PR; this clogs the CI pipeline and affects other PR's; if you don't need it (e.g. for WIP or documentation only changes), add <tt class="docutils literal"><span class="pre">[skip ci]</span></tt> to your commit message title. This convention is supported by our github actions pipelines and our azure pipeline (using custom logic, which should complete in &lt; 1mn) as well as our former other pipelines: <a class="reference external" href="https://www.appveyor.com/docs/how-to/filtering-commits/#skip-directive-in-commit-message">Appveyor</a> and <a class="reference external" href="https://docs.travis-ci.com/user/customizing-the-build/#skipping-a-build">Travis</a>.</li>
<li>Consider enabling CI (azure, GitHub actions and builds.sr.ht) in your own  NimSkull fork, and waiting for CI to be green in that fork (fixing bugs as needed) before opening your PR in the original  NimSkull repo, so as to reduce CI congestion. Same applies for updates on a PR: you can test commits on a separate private branch before updating the main PR.</li>
</ol>

<h2><a class="toc-backref" id="the-cmdgit-stuff-debugging-ci-failures-flaky-tests-etc" href="#the-cmdgit-stuff-debugging-ci-failures-flaky-tests-etc">Debugging CI failures, flaky tests, etc</a></h2><ol class="simple"><li>First check the CI logs and search for <tt class="docutils literal"><span class="pre"><span class="Identifier">FAIL</span></span></tt> to find why CI failed; if the failure seems related to your PR, try to fix the code instead of restarting CI.</li>
<li>If CI failure seems unrelated to your PR, it could be caused by a flaky test. File a bug for it if it isn't already reported. A PR push (or opening/closing PR) will re-trigger all CI jobs (even successful ones, which can be wasteful). Instead, follow these instructions to only restart the jobs that failed:<ul class="simple"><li>Azure: if on your own fork, it's possible from inside azure console (e.g. <tt class="docutils literal"><span class="pre">dev.azure.com/username/username/_build/results?buildId=1430&amp;view=results</span></tt>) via <tt class="docutils literal"><span class="pre">rerun failed jobs</span></tt> on top. If either on you own fork or in  NimSkull repo, it's possible from inside GitHub UI under checks tab, see <a class="reference external" href="https://github.com/timotheecour/Nim/issues/211#issuecomment-629751569">https://github.com/timotheecour/Nim/issues/211#issuecomment-629751569</a></li>
<li>GitHub actions: under &quot;Checks&quot; tab, click &quot;Re-run jobs&quot; in the right.</li>
<li>builds.sr.ht: create a sourcehut account so you can restart a PR job as illustrated. builds.sr.ht also allows you to ssh to a CI machine which can help a lot for debugging issues, see docs in <a class="reference external" href="https://man.sr.ht/builds.sr.ht/build-ssh.md">https://man.sr.ht/builds.sr.ht/build-ssh.md</a> and <a class="reference external" href="https://drewdevault.com/2019/08/19/Introducing-shell-access-for-builds.html">https://drewdevault.com/2019/08/19/Introducing-shell-access-for-builds.html</a>; see <a class="reference external" href="https://man.sr.ht/tutorials/set-up-account-and-git.md">https://man.sr.ht/tutorials/set-up-account-and-git.md</a> to generate and upload ssh keys.</li>
</ul>
</li>
</ol>

<h1><a class="toc-backref" id="documentation-style" href="#documentation-style">Documentation Style</a></h1>
<h2><a class="toc-backref" id="documentation-style-general-guidelines" href="#documentation-style-general-guidelines">General Guidelines</a></h2><ul class="simple"><li>See also <a class="reference external" href="https://nim-lang.github.io/Nim/nep1.html">nep1</a>.</li>
<li>Authors should document anything that is exported; documentation for private procs can be useful too (visible via <tt class="docutils literal"><span class="pre"><span class="program">nim</span> <span class="option">doc</span> <span class="option">--docInternal</span> <span class="Identifier">foo.nim</span></span></tt>).</li>
<li>Within documentation, a period (<tt class="docutils literal"><span class="pre"><span class="Operator">.</span></span></tt>) should follow each sentence (or sentence fragment) in a comment block. The documentation may be limited to one sentence fragment, but if multiple sentences are within the documentation, each sentence after the first should be complete and in present tense.</li>
<li>Documentation is parsed as a custom ReStructuredText (RST) with partial markdown support.</li>
<li>In nim sources, prefer single backticks to double backticks since it's simpler and <tt class="docutils literal"><span class="pre"><span class="program">nim</span> <span class="option">doc</span></span></tt> supports it. Likewise with <tt class="docutils literal"><span class="pre">rst</span></tt> files: <tt class="docutils literal"><span class="pre"><span class="program">nim</span> <span class="option">rst2html</span></span></tt> will render those as monospace, and adding <tt class="docutils literal"><span class="pre">.. default-role:: code</span></tt> to an <tt class="docutils literal"><span class="pre">rst</span></tt> file will also make those render as monospace when rendered directly in tools such as github.</li>
</ul>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">someproc</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">s</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">,</span> <span class="Identifier">foo</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Comment">## Use single backticks for inline code, e.g.: `s` or `someExpr(true)`.</span>
  <span class="Comment">## Use a backlash to follow with alphanumeric char: `int8`\s are great.</span></pre>
<h2><a class="toc-backref" id="documentation-style-moduleminuslevel-documentation" href="#documentation-style-moduleminuslevel-documentation">Module-level documentation</a></h2><p>Documentation of a module is placed at the top of the module itself. Each line of documentation begins with double hashes (<tt class="docutils literal"><span class="pre"><span class="Comment">##</span></span></tt>). Sometimes <tt class="docutils literal"><span class="pre"><span class="LongComment">##[ multiline docs containing code ]##</span></span></tt> is preferable, see <tt class="docutils literal"><span class="pre">lib/pure/times.nim</span></tt>. Code samples are encouraged, and should follow the general RST syntax:</p>
<pre class="listing"><span class="Comment">## The `universe` module computes the answer to life, the universe, and everything.</span>
<span class="Comment">##</span>
<span class="Comment">## .. code-block::</span>
<span class="Comment">##  doAssert computeAnswerString() == 42</span></pre><p>Within this top-level comment, you can indicate the authorship and copyright of the code, which will be featured in the produced documentation.</p>
<pre class="listing"><span class="Comment">## This is the best module ever. It provides answers to everything!</span>
<span class="Comment">##</span>
<span class="Comment">## :Author: Steve McQueen</span>
<span class="Comment">## :Copyright: 1965</span>
<span class="Comment">##</span></pre><p>Leave a space between the last line of top-level documentation and the beginning of  NimSkull code (the imports, etc.).</p>

<h2><a class="toc-backref" id="documentation-style-procs-templates-macros-converters-and-iterators" href="#documentation-style-procs-templates-macros-converters-and-iterators">Procs, Templates, Macros, Converters, and Iterators</a></h2><p>The documentation of a procedure should begin with a capital letter and should be in present tense. Variables referenced in the documentation should be surrounded by single tick marks:</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">example1</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Comment">## Prints the value of `x`.</span>
  <span class="Identifier">echo</span> <span class="Identifier">x</span></pre><p>Whenever an example of usage would be helpful to the user, you should include one within the documentation in RST format as below.</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">addThree</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">,</span> <span class="Identifier">y</span><span class="Punctuation">,</span> <span class="Identifier">z</span><span class="Punctuation">:</span> <span class="Identifier">int8</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">int</span> <span class="Operator">=</span>
  <span class="Comment">## Adds three `int8` values, treating them as unsigned and</span>
  <span class="Comment">## truncating the result.</span>
  <span class="Comment">##</span>
  <span class="Comment">## .. code-block::</span>
  <span class="Comment">##  # things that aren't suitable for a `runnableExamples` go in code-block:</span>
  <span class="Comment">##  echo execCmdEx(&quot;git pull&quot;)</span>
  <span class="Comment">##  drawOnScreen()</span>
  <span class="Identifier">runnableExamples</span><span class="Punctuation">:</span>
    <span class="Comment"># `runnableExamples` is usually preferred to ``code-block``, when possible.</span>
    <span class="Identifier">doAssert</span> <span class="Identifier">addThree</span><span class="Punctuation">(</span><span class="DecNumber">3</span><span class="Punctuation">,</span> <span class="DecNumber">125</span><span class="Punctuation">,</span> <span class="DecNumber">6</span><span class="Punctuation">)</span> <span class="Operator">==</span> <span class="Operator">-</span><span class="DecNumber">122</span>
  <span class="Identifier">result</span> <span class="Operator">=</span> <span class="Identifier">x</span> <span class="Operator">+%</span> <span class="Identifier">y</span> <span class="Operator">+%</span> <span class="Identifier">z</span></pre><p>The command <tt class="docutils literal"><span class="pre"><span class="program">nim</span> <span class="option">doc</span></span></tt> will then correctly syntax highlight the  NimSkull code within the documentation.</p>

<h2><a class="toc-backref" id="documentation-style-types" href="#documentation-style-types">Types</a></h2><p>Exported types should also be documented. This documentation can also contain code samples, but those are better placed with the functions to which they refer.</p>
<pre class="listing"><span class="Keyword">type</span>
  <span class="Identifier">NamedQueue</span><span class="Operator">*</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Keyword">object</span> <span class="Comment">## Provides a linked data structure with names</span>
                          <span class="Comment">## throughout. It is named for convenience. I'm making</span>
                          <span class="Comment">## this comment long to show how you can, too.</span>
    <span class="Identifier">name</span><span class="Operator">*:</span> <span class="Identifier">string</span> <span class="Comment">## The name of the item</span>
    <span class="Identifier">val</span><span class="Operator">*:</span> <span class="Identifier">T</span> <span class="Comment">## Its value</span>
    <span class="Identifier">next</span><span class="Operator">*:</span> <span class="Keyword">ref</span> <span class="Identifier">NamedQueue</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Comment">## The next item in the queue</span></pre><p>You have some flexibility when placing the documentation:</p>
<pre class="listing"><span class="Keyword">type</span>
  <span class="Identifier">NamedQueue</span><span class="Operator">*</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Keyword">object</span>
    <span class="Comment">## Provides a linked data structure with names</span>
    <span class="Comment">## throughout. It is named for convenience. I'm making</span>
    <span class="Comment">## this comment long to show how you can, too.</span>
    <span class="Identifier">name</span><span class="Operator">*:</span> <span class="Identifier">string</span> <span class="Comment">## The name of the item</span>
    <span class="Identifier">val</span><span class="Operator">*:</span> <span class="Identifier">T</span> <span class="Comment">## Its value</span>
    <span class="Identifier">next</span><span class="Operator">*:</span> <span class="Keyword">ref</span> <span class="Identifier">NamedQueue</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Comment">## The next item in the queue</span></pre><p>Make sure to place the documentation beside or within the object.</p>
<pre class="listing"><span class="Keyword">type</span>
  <span class="Comment">## Bad: this documentation disappears because it annotates the `type` keyword</span>
  <span class="Comment">## above, not `NamedQueue`.</span>
  <span class="Identifier">NamedQueue</span><span class="Operator">*</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Keyword">object</span>
    <span class="Identifier">name</span><span class="Operator">*:</span> <span class="Identifier">string</span> <span class="Comment">## This becomes the main documentation for the object, which</span>
                  <span class="Comment">## is not what we want.</span>
    <span class="Identifier">val</span><span class="Operator">*:</span> <span class="Identifier">T</span> <span class="Comment">## Its value</span>
    <span class="Identifier">next</span><span class="Operator">*:</span> <span class="Keyword">ref</span> <span class="Identifier">NamedQueue</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Comment">## The next item in the queue</span></pre>
<h2><a class="toc-backref" id="documentation-style-var-let-and-const" href="#documentation-style-var-let-and-const">Var, Let, and Const</a></h2><p>When declaring module-wide constants and values, documentation is encouraged. The placement of doc comments is similar to the <tt class="docutils literal"><span class="pre"><span class="Keyword">type</span></span></tt> sections.</p>
<pre class="listing"><span class="Keyword">const</span>
  <span class="Identifier">X</span><span class="Operator">*</span> <span class="Operator">=</span> <span class="DecNumber">42</span> <span class="Comment">## An awesome number.</span>
  <span class="Identifier">SpreadArray</span><span class="Operator">*</span> <span class="Operator">=</span> <span class="Punctuation">[</span>
    <span class="Punctuation">[</span><span class="DecNumber">1</span><span class="Punctuation">,</span><span class="DecNumber">2</span><span class="Punctuation">,</span><span class="DecNumber">3</span><span class="Punctuation">]</span><span class="Punctuation">,</span>
    <span class="Punctuation">[</span><span class="DecNumber">2</span><span class="Punctuation">,</span><span class="DecNumber">3</span><span class="Punctuation">,</span><span class="DecNumber">1</span><span class="Punctuation">]</span><span class="Punctuation">,</span>
    <span class="Punctuation">[</span><span class="DecNumber">3</span><span class="Punctuation">,</span><span class="DecNumber">1</span><span class="Punctuation">,</span><span class="DecNumber">2</span><span class="Punctuation">]</span><span class="Punctuation">,</span>
  <span class="Punctuation">]</span> <span class="Comment">## Doc comment for `SpreadArray`.</span></pre><p>Placement of comments in other areas is usually allowed, but will not become part of the documentation output and should therefore be prefaced by a single hash (<tt class="docutils literal"><span class="pre"><span class="Comment">#</span></span></tt>).</p>
<pre class="listing"><span class="Keyword">const</span>
  <span class="Identifier">BadMathVals</span><span class="Operator">*</span> <span class="Operator">=</span> <span class="Punctuation">[</span>
    <span class="FloatNumber">3.14</span><span class="Punctuation">,</span> <span class="Comment"># pi</span>
    <span class="FloatNumber">2.72</span><span class="Punctuation">,</span> <span class="Comment"># e</span>
    <span class="FloatNumber">0.58</span><span class="Punctuation">,</span> <span class="Comment"># gamma</span>
  <span class="Punctuation">]</span> <span class="Comment">## A bunch of badly rounded values.</span></pre><p> NimSkull supports Unicode in comments, so the above can be replaced with the following:</p>
<pre class="listing"><span class="Keyword">const</span>
  <span class="Identifier">BadMathVals</span><span class="Operator">*</span> <span class="Operator">=</span> <span class="Punctuation">[</span>
    <span class="FloatNumber">3.14</span><span class="Punctuation">,</span> <span class="Comment"># π</span>
    <span class="FloatNumber">2.72</span><span class="Punctuation">,</span> <span class="Comment"># e</span>
    <span class="FloatNumber">0.58</span><span class="Punctuation">,</span> <span class="Comment"># γ</span>
  <span class="Punctuation">]</span> <span class="Comment">## A bunch of badly rounded values.</span></pre>
<h1><a class="toc-backref" id="evolving-the-stdlib" href="#evolving-the-stdlib">Evolving the stdlib</a></h1>
<h2><a class="toc-backref" id="evolving-the-stdlib-what-the-compiler-itself-needs-must-be-part-of-the-stdlib" href="#evolving-the-stdlib-what-the-compiler-itself-needs-must-be-part-of-the-stdlib">What the compiler itself needs must be part of the stdlib</a></h2><p>Maybe in the future the compiler itself can depend on Nimble packages but for the time being, we strive to have zero dependencies in the compiler as the compiler is the root of the bootstrapping process and is also used to build Nimble.</p>

<h2><a class="toc-backref" id="evolving-the-stdlib-vocabulary-types-must-be-part-of-the-stdlib" href="#evolving-the-stdlib-vocabulary-types-must-be-part-of-the-stdlib">Vocabulary types must be part of the stdlib</a></h2><p>These are types most packages need to agree on for better interoperability, for example <tt class="docutils literal"><span class="pre"><span class="Identifier">Option</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span></span></tt>. This rule also covers the existing collections like <tt class="docutils literal"><span class="pre"><span class="Identifier">Table</span></span></tt>, <tt class="docutils literal"><span class="pre"><span class="Identifier">CountTable</span></span></tt> etc. &quot;Sorted&quot; containers based on a tree-like data structure are still missing and should be added.</p>
<p>Time handling, especially the <tt class="docutils literal"><span class="pre"><span class="Identifier">Time</span></span></tt> type are also covered by this rule.</p>

<h2><a class="toc-backref" id="evolving-the-stdlib-existing-battleminustested-modules-stay" href="#evolving-the-stdlib-existing-battleminustested-modules-stay">Existing, battle-tested modules stay</a></h2><p>Reason: There is no benefit in moving them around just to fullfill some design fashion as in &quot; NimSkull's core MUST BE SMALL&quot;. If you don't like an existing module, don't import it. If a compilation target (e.g. JS) cannot support a module, document this limitation.</p>
<p>This covers modules like <tt class="docutils literal"><span class="pre"><span class="Identifier">os</span></span></tt>, <tt class="docutils literal"><span class="pre"><span class="Identifier">osproc</span></span></tt>, <tt class="docutils literal"><span class="pre"><span class="Identifier">strscans</span></span></tt>, <tt class="docutils literal"><span class="pre"><span class="Identifier">strutils</span></span></tt>, <tt class="docutils literal"><span class="pre"><span class="Identifier">strformat</span></span></tt>, etc.</p>

<h2><a class="toc-backref" id="evolving-the-stdlib-syntactic-helpers-can-start-as-experimental-stdlib-modules" href="#evolving-the-stdlib-syntactic-helpers-can-start-as-experimental-stdlib-modules">Syntactic helpers can start as experimental stdlib modules</a></h2><p>Reason: Generally speaking as external dependencies they are not exposed to enough users so that we can see if the shortcuts provide enough benefit or not. Many programmers avoid external dependencies, even moreso for &quot;tiny syntactic improvements&quot;. However, this is only true for really good syntactic improvements that have the potential to clean up other parts of the  NimSkull library substantially. If in doubt, new stdlib modules should start as external, successful Nimble packages.</p>

<h2><a class="toc-backref" id="evolving-the-stdlib-other-new-stdlib-modules-do-not-start-as-stdlib-modules" href="#evolving-the-stdlib-other-new-stdlib-modules-do-not-start-as-stdlib-modules">Other new stdlib modules do not start as stdlib modules</a></h2><p>As we strive for higher quality everywhere, it's easier to adopt existing, battle-tested modules eventually rather than creating modules from scratch.</p>

<h2><a class="toc-backref" id="evolving-the-stdlib-little-additions-are-acceptable" href="#evolving-the-stdlib-little-additions-are-acceptable">Little additions are acceptable</a></h2><p>As long as they are documented and tested well, adding little helpers to existing modules is acceptable. For two reasons:</p>
<ol class="simple"><li>It makes  NimSkull easier to learn and use in the long run. (&quot;Why does sequtils lack a <tt class="docutils literal"><span class="pre"><span class="Identifier">countIt</span></span></tt>? Because version 1.0 happens to have lacked it? Silly...&quot;)</li>
<li>To encourage contributions. Contributors often start with PRs that add simple things and then they stay and also fix bugs.  NimSkull is an open source project and lives from people's contributions and involvement. Newly introduced issues have to be balanced against motivating new people. We know where to find perfectly designed pieces of software that have no bugs -- these are the systems that nobody uses.</li>
</ol>

<h2><a class="toc-backref" id="evolving-the-stdlib-conventions" href="#evolving-the-stdlib-conventions">Conventions</a></h2><ol class="simple"><li>New stdlib modules should go under <tt class="docutils literal"><span class="pre">Nim/lib/std/</span></tt>. The rationale is to require users to import via <tt class="docutils literal"><span class="pre"><span class="Keyword">import</span> <span class="Identifier">std</span><span class="Operator">/</span><span class="Identifier">foo</span></span></tt> instead of <tt class="docutils literal"><span class="pre"><span class="Keyword">import</span> <span class="Identifier">foo</span></span></tt>, which would cause potential conflicts with nimble packages. Note that this still applies for new modules in existing logical directories, e.g.: use <tt class="docutils literal"><span class="pre">lib/std/collections/foo.nim</span></tt>, not <tt class="docutils literal"><span class="pre">lib/pure/collections/foo.nim</span></tt>.</li>
<li>New module names should prefer plural form whenever possible, e.g.: <tt class="docutils literal"><span class="pre">std/sums.nim</span></tt> instead of <tt class="docutils literal"><span class="pre">std/sum.nim</span></tt>. In particular, this reduces chances of conflicts between module name and the symbols it defines. Furthermore, module names should use <tt class="docutils literal"><span class="pre"><span class="Identifier">snake_case</span></span></tt> and not use capital letters, which cause issues when going from an OS without case sensitivity to an OS with it.</li>
</ol>

<h1><a class="toc-backref" id="breaking-changes" href="#breaking-changes">Breaking Changes</a></h1><p>Introducing breaking changes, no matter how well intentioned, creates long-term problems for the community, in particular those looking to promote reusable  NimSkull code in libraries: In the  NimSkull distribution, critical security and bugfixes, language changes and community improvements are bundled in a single distribution - it is difficult to make partial upgrades with only benign changes. When one library depends on a legacy behavior, it can no longer be used together with another library that does not, breaking all downstream applications - the standard library is unique in that it sits at the root of <strong>all</strong> dependency trees.</p>
<p>There is a big difference between compile-time breaking changes and run-time breaking changes.</p>

<h2><a class="toc-backref" id="breaking-changes-runminustime-breaking-changes" href="#breaking-changes-runminustime-breaking-changes">Run-time breaking changes</a></h2><p>Run-time breaking changes are to be avoided at almost all costs:  NimSkull is used for mission critical applications which depend on behaviours that are not covered by the test suite. As such, it's important that changes to the <em>stable</em> parts of the standard library are made avoiding changing the existing behaviors, even when the test suite continues to pass.</p>
<p>Examples of run-time breaking changes:</p>
<ul class="simple"><li>Raising exceptions of a new type, compared to what's currently being raised.</li>
<li>Adding unconstrained or poorly constrained generic procs or macros (&quot;hash now works for all <tt class="docutils literal"><span class="pre"><span class="Keyword">ref</span> <span class="Identifier">T</span></span></tt>&quot;): This may cause code to behave differently depending only on which modules are imported - common examples include <tt class="docutils literal"><span class="pre"><span class="Operator">==</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">hash</span></span></tt>.</li>
<li>Changing behavior of existing functions like:<ul class="simple"><li>&quot; NimSkull's path handling procs like <tt class="docutils literal"><span class="pre"><span class="Identifier">getXDir</span></span></tt> now consistently lack the trailing slash&quot;</li>
<li>&quot; NimSkull's strformat implementation is now more consistent with Python&quot;</li>
</ul>
</li>
</ul>
<p>Instead write new code that explicitly announces the feature you think we announced but didn't. For example, <tt class="docutils literal"><span class="pre"><span class="Identifier">strformat</span></span></tt> does not say &quot;it's compatible with Python&quot;, it says &quot;inspired by Python's f-strings&quot;. This new code can be submitted to the stdlib and the old code can be deprecated or it can be published as a Nimble package.</p>
<p>Sometimes, a run-time breaking change is most desirable: For example, a string representation of a floating point number that &quot;roundtrips&quot; is much better than a string represenation that doesn't. These run-time breaking changes must start in the state &quot;opt-in&quot; via a new <tt class="docutils literal"><span class="pre"><span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">nimPreviewX</span></span></tt> or command line flag and then should become the new default later, in follow-up versions. This way users can track regressions more easily. (&quot;git bisect&quot; is not an acceptable alternative, that's for Nim compiler developers, not for  NimSkull users.)</p>
<p>Above all else, additive approaches that don't change existing behaviors should be preferred.</p>

<h2><a class="toc-backref" id="breaking-changes-compileminustime-breaking-changes" href="#breaking-changes-compileminustime-breaking-changes">Compile-time breaking changes</a></h2><p>Compile-time breaking changes are usually easier to handle, but for large code bases it can also be much work and it can hinder the adoption of a new  NimSkull release. Additive approaches are to be preferred here as well.</p>
<p>Examples of compile-time breaking changes include (but are not limited to):</p>
<ul class="simple"><li>Renaming functions and modules, or moving things. Instead of a direct rename, deprecate the old name and introduce a new one.</li>
<li>Renaming the parameter names: Thanks to  NimSkull's &quot;named parameter&quot; calling syntax like <tt class="docutils literal"><span class="pre"><span class="Identifier">f</span><span class="Punctuation">(</span><span class="Identifier">x</span> <span class="Operator">=</span> <span class="DecNumber">0</span><span class="Punctuation">,</span> <span class="Identifier">y</span> <span class="Operator">=</span> <span class="DecNumber">1</span><span class="Punctuation">)</span></span></tt> this is a breaking change. Instead live with the existing parameter names.</li>
<li>Adding an enum value to an existing enum.  NimSkull's exhaustive case statements stop compiling after such a change. Instead consider to introduce new <tt class="docutils literal"><span class="pre"><span class="Identifier">bool</span></span></tt> fields/parameters. This can be impractical though, so we use good judgement and our list of &quot;important packages&quot; to see if it doesn't break too much code out there in practice.</li>
<li>Adding a new proc to an existing stdlib module. However, for aesthetic reasons this is often preferred over introducing a new module with just a single proc inside. We use good judgement and our list of &quot;important packages&quot; to see if it doesn't break too much code out there in practice. The new procs need to be annotated with a <tt class="docutils literal"><span class="pre"><span class="Operator">.</span><span class="Identifier">since</span></span></tt> annotation.</li>
</ul>

<h2><a class="toc-backref" id="breaking-changes-compilerslashlanguage-spec-bugfixes" href="#breaking-changes-compilerslashlanguage-spec-bugfixes">Compiler/language spec bugfixes</a></h2><p>This can even be applied to compiler &quot;bugfixes&quot;: If the compiler should have been &quot;pickier&quot; in its handling of <tt class="docutils literal"><span class="pre"><span class="Identifier">typedesc</span></span></tt>, instead of &quot;fixing typedesc handling bugs&quot;, consider the following solution:</p>
<ul class="simple"><li>Spec out how <tt class="docutils literal"><span class="pre"><span class="Identifier">typedesc</span></span></tt> should really work and also spec out the cases where it should not be allowed!</li>
<li>Deprecate <tt class="docutils literal"><span class="pre"><span class="Identifier">typedesc</span></span></tt> and name the new metatype something new like <tt class="docutils literal"><span class="pre"><span class="Identifier">typeArg</span></span></tt>.</li>
<li>Implement the spec.</li>
</ul>

<h2><a class="toc-backref" id="breaking-changes-nonminusbreaking-changes" href="#breaking-changes-nonminusbreaking-changes">Non-breaking changes</a></h2><p>Examples of changes that are considered non-breaking (or acceptable breaking changes) include:</p>
<ul class="simple"><li>Creating a new module.</li>
<li>Adding an overload to an already overloaded proc.</li>
<li>Adding new default parameters to an existing proc. It is assumed that you do not use  NimSkull's stdlib procs's addresses (that you don't use them as first class entities).</li>
<li>Changing the calling convention from <tt class="docutils literal"><span class="pre"><span class="Identifier">nimcall</span></span></tt> to <tt class="docutils literal"><span class="pre"><span class="Identifier">inline</span></span></tt> (but first RFC <a class="reference external" href="https://github.com/nim-lang/RFCs/issues/396">https://github.com/nim-lang/RFCs/issues/396</a> needs to be implemented).</li>
<li>Changing the behavior from &quot;crashing&quot; into some other, well documented result (including raising a Defect, but not raising an exception that does not inherit from Defect).</li>
<li>Adding new fields to an existing object.</li>
</ul>
<p>Nim's introspection facilities imply that strictly speaking almost every addition can break somebody's code. It is impractical to care about these cases, a change that only affects introspection is not considered to be a breaking change. </p>
</p>
  
  </div>
</div>

    <div class="row">
      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br/>
        <small style="color: var(--hint);">Made with Nim. Generated: 2022-01-19 05:05:28 UTC</small>
      </div>
    </div>
  </div>
</div>

</body>
</html>
